{"version":3,"sources":["webpack:///./src/views/Search/index.styl?45c9","views/Search/index.styl","views/Search/index.js"],"names":["content","module","i","options","locals","exports","push","connect","state","musicPlayer","dispatch","props","useState","hotKeys","setHotKeys","searchValue","setSearchValue","suggestData","setSuggestData","suggestFocus","setSuggestFocus","showConfirm","setShowConfirm","useEffect","postHotSearch","then","resp","data","result","hots","console","info","searchHistory","searchSuggestTimer","useRef","handleChange","e","clearTimeout","current","setTimeout","postSearchSuggest","handleHotKeyClick","item","index","first","history","className","placeholder","onChange","value","onSearch","onBlur","onFocus","map","onClick","bind","key","ifShow","length","list","onItemDelete","deleteSearchHistory","onItemClick","Object","keys","word","type","name","artists","join","pathname","id","artist","saveSearchHistory","text","show","onConfirmClick","clearSearchHistory","onCancelClick","bool","style","display"],"mappings":"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","file":"neteasemusic/static/js/6.10ec5d1d.chunk.js","sourcesContent":["var content = require(\"!!../../../node_modules/css-loader/dist/cjs.js!../../../node_modules/stylus-loader/index.js!./index.styl\");\n\nif (typeof content === 'string') {\n  content = [[module.id, content, '']];\n}\n\nvar options = {}\n\noptions.insert = \"head\";\noptions.singleton = false;\n\nvar update = require(\"!../../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\")(content, options);\n\nif (content.locals) {\n  module.exports = content.locals;\n}\n","exports = module.exports = require(\"../../../node_modules/css-loader/dist/runtime/api.js\")(false);\n// Module\nexports.push([module.id, \".search .search-box-wrapper {\\n  margin: 20px;\\n}\\n.search .shortcut-wrapper {\\n  position: fixed;\\n  top: 178px;\\n  bottom: 0;\\n  width: 100%;\\n}\\n.search .shortcut-wrapper .shortcut {\\n  height: calc(100vh - 240px);\\n  overflow: hidden;\\n}\\n.search .shortcut-wrapper .shortcut .hot-key {\\n  margin: 0 20px 20px 20px;\\n}\\n.search .shortcut-wrapper .shortcut .hot-key .title {\\n  margin-bottom: 20px;\\n  font-size: 14px;\\n  color: rgba(255,255,255,0.5);\\n}\\n.search .shortcut-wrapper .shortcut .hot-key .item {\\n  display: inline-block;\\n  padding: 5px 10px;\\n  margin: 0 20px 10px 0;\\n  border-radius: 6px;\\n  background: #333;\\n  font-size: 14px;\\n  color: rgba(255,255,255,0.3);\\n}\\n.search .shortcut-wrapper .shortcut .search-history {\\n  position: relative;\\n  margin: 0 20px;\\n}\\n.search .shortcut-wrapper .shortcut .search-history .title {\\n  display: flex;\\n  align-items: center;\\n  height: 40px;\\n  font-size: 14px;\\n  color: rgba(255,255,255,0.5);\\n}\\n.search .shortcut-wrapper .shortcut .search-history .title .text {\\n  flex: 1;\\n}\\n.search .shortcut-wrapper .shortcut .search-history .title .clear {\\n  position: relative;\\n}\\n.search .shortcut-wrapper .shortcut .search-history .title .clear:before {\\n  content: '';\\n  position: absolute;\\n  top: -10px;\\n  left: -10px;\\n  right: -10px;\\n  bottom: -10px;\\n}\\n.search .shortcut-wrapper .shortcut .search-history .title .clear .icon-clear {\\n  font-size: 14px;\\n  color: rgba(255,255,255,0.3);\\n}\\n.search .search-result {\\n  position: fixed;\\n  width: 100%;\\n  top: 145px;\\n  bottom: 0;\\n}\\n\", \"\"]);\n\n","import React, {useState, useRef, useEffect} from 'react';\r\nimport './index.styl'\r\nimport {SearchBox, Suggest, SearchList, Confirm, MyScroll} from \"../../components\";\r\nimport {postHotSearch, postSearchSuggest, postSearch} from \"../../services/NetEaseAxios\";\r\nimport {connect} from \"react-redux\";\r\nimport * as dispatch from '../../actions/musicPlayer'\r\n\r\n\r\nfunction Search(props) {\r\n\r\n    const [hotKeys, setHotKeys] = useState([]);\r\n    const [searchValue, setSearchValue] = useState('');\r\n    const [suggestData, setSuggestData] = useState({});\r\n    const [suggestFocus, setSuggestFocus] = useState(false);\r\n    const [showConfirm, setShowConfirm] = useState(false);\r\n\r\n\r\n    useEffect(() => {\r\n        postHotSearch().then(resp => {\r\n            setHotKeys(resp.data.result.hots);\r\n        });\r\n        console.info('aaa', props.musicPlayer.searchHistory);\r\n    }, []);\r\n\r\n    const searchSuggestTimer = useRef(0);\r\n\r\n    function handleChange(e) {\r\n        setSearchValue(e);\r\n        clearTimeout(searchSuggestTimer.current);\r\n        if (e === '') {\r\n            setSuggestData({});\r\n            return;\r\n        }\r\n        searchSuggestTimer.current = setTimeout(() => {\r\n            postSearchSuggest(e).then(resp => {\r\n                if (resp.data.result) {\r\n                    setSuggestData(resp.data.result);\r\n                } else {\r\n                    setSuggestData({});\r\n                }\r\n            });\r\n        }, 200);\r\n\r\n    }\r\n\r\n    function handleHotKeyClick(item, index) {\r\n        console.info(searchValue);\r\n        setSearchValue(item.first);\r\n        props.history.push(`/search/${item.first}`);\r\n    }\r\n\r\n    function handleSearch(value) {\r\n        props.history.push(`/search/${value}`);\r\n    }\r\n\r\n    function handleSuggestItemClick(item, type) {\r\n        // if(type === 'ar')\r\n        console.info(type);\r\n        // alert();\r\n        if (type === 'songs') {\r\n            // this.props.history.push({\r\n            //     pathname: `/singer/${item.id}`,\r\n            //     state: {artist: item}\r\n            // });\r\n            const value = `${item.name} ${item.artists.map(i => i.name).join(' ')}`;\r\n            setSearchValue(value);\r\n            props.history.push(`/search/${value}`);\r\n        } else if (type === 'artists') {\r\n\r\n            props.history.push({\r\n                pathname: `/singer/${item.id}`,\r\n                state: {artist: item}\r\n            });\r\n            props.saveSearchHistory(item.name);\r\n        }\r\n        // props.history.push(`/search/${item.}`);\r\n        console.info(item);\r\n    }\r\n\r\n    function handleSearchBlur() {\r\n        setSuggestFocus(false);\r\n    }\r\n\r\n    function handleSearchFocus() {\r\n        setSuggestFocus(true);\r\n        handleChange(searchValue);\r\n    }\r\n\r\n    function handleHistoryDelete(item) {\r\n        props.deleteSearchHistory(item)\r\n    }\r\n\r\n    function handleHistoryClick(item) {\r\n        setSearchValue(item);\r\n        props.history.push(`/search/${item}`);\r\n    }\r\n\r\n    function handleClearHistory() {\r\n        setShowConfirm(true);\r\n\r\n    }\r\n\r\n    function handleConfirmClick() {\r\n        setShowConfirm(false);\r\n        props.clearSearchHistory();\r\n    }\r\n\r\n    function handleCancelClick() {\r\n        setShowConfirm(false);\r\n    }\r\n\r\n    return (\r\n        <div className={'search'}>\r\n            <div className=\"search-box-wrapper\">\r\n                <SearchBox placeholder={'搜索'} onChange={handleChange} value={searchValue}\r\n                           onSearch={handleSearch} onBlur={handleSearchBlur} onFocus={handleSearchFocus}></SearchBox>\r\n            </div>\r\n            <div className=\"shortcut-wrapper\">\r\n                <MyScroll className=\"shortcut\">\r\n                    <div className=\"hot-key\">\r\n                        <h1 className=\"title\">热门搜索</h1>\r\n                        <ul>{\r\n                            hotKeys.map((item, index) => (<li\r\n                                className={'item'}\r\n                                onClick={handleHotKeyClick.bind(this, item, index)}\r\n                                key={`hots${item.first}`}>{item.first}</li>))\r\n                        }</ul>\r\n                    </div>\r\n                    <div className=\"search-history\" {...ifShow(props.musicPlayer.searchHistory.length)}>\r\n                        <h1 className=\"title\">\r\n                            <span className=\"text\">搜索历史</span>\r\n                            <span className=\"clear\" onClick={handleClearHistory}>\r\n                                <i className=\"icon-clear\"></i>\r\n                            </span>\r\n                        </h1>\r\n                        <SearchList list={props.musicPlayer.searchHistory}\r\n                                    onItemDelete={handleHistoryDelete} onItemClick={handleHistoryClick}></SearchList>\r\n                    </div>\r\n                </MyScroll>\r\n            </div>\r\n            <div className=\"search-result\" {...ifShow(suggestFocus && Object.keys(suggestData).length > 0)}>\r\n                <Suggest data={suggestData} word={searchValue} onItemClick={handleSuggestItemClick}></Suggest>\r\n            </div>\r\n            <Confirm text={'确定清空？'} show={showConfirm} onConfirmClick={handleConfirmClick}\r\n                     onCancelClick={handleCancelClick}></Confirm>\r\n        </div>\r\n    );\r\n\r\n    function ifShow(bool) {\r\n        if (!bool) {\r\n            return {style: {display: 'none',}}\r\n        }\r\n    }\r\n\r\n}\r\n\r\nexport default connect(state => ({musicPlayer: state.musicPlayer}), {...dispatch})(Search);"],"sourceRoot":""}